from flask import Flask, request, jsonify
import sqlite3

app = Flask(__name__)

# Fonction pour récupérer un utilisateur depuis la base de données
def get_user_by_email(email):
    conn = sqlite3.connect('database.db')
    cursor = conn.cursor()
    
    # Requête pour récupérer l'utilisateur en fonction de l'email
    cursor.execute("SELECT email, password, salt FROM users WHERE email = ?", (email,))
    
    # Récupérer un seul résultat
    user = cursor.fetchone()
    
    # Fermer la connexion à la base de données
    conn.close()
    
    return user

@app.route('/login', methods=['POST'])
def login_send():
    # Récupérer les données JSON envoyées dans la requête
    data = request.get_json()
    email = data.get('email')
    password = data.get('password')
    
    # Vérifier si l'utilisateur existe dans la base de données
    user = get_user_by_email(email)
    
    if user:
        # Récupérer le sel de l'utilisateur
        salt = user[2]  # Le sel est à la 3ème position (index 2) dans le résultat de la requête
        return jsonify({"message": salt}), 200  # Répondre avec le sel de l'utilisateur
    else:
        return jsonify({"message": "Utilisateur non trouvé"}), 404

if __name__ == '__main__':
    app.run(debug=True)
